@using HALLA_PM.Models;
@using HALLA_PM.Util;
@{
    ViewBag.Title = "Edit";
    Layout = "~/Views/Shared/_LayoutSiteMng.cshtml";

    NoticeExp notice = Model.notice;
    Search search = ViewBag.Search;
}

<div id="container">
    <div class="location">
        <span class="home"><i class="fa fa-home"></i></span>
        <span>안내/알림관리</span>
        <strong>공지사항 관리</strong>
    </div>

    <form name="editForm" id="editForm" enctype="multipart/form-data">
        <input type="hidden" name="seq" id="seq" value="@notice.seq" />
        <input type="hidden" id="inputName" name="inputName" value="" />
        <input type="hidden" name="PageIndex" value="@(search.PageIndex)" />
        <input type="hidden" name="searchType" value="@(search.searchType)" />
        <input type="hidden" name="searchText" value="@(search.searchText)" />
        <div class="con_box search">
            <h3 class="mt0">공지사항 관리</h3>
            <div class="bg_gray">
                <i class="fa fa-info-circle" aria-hidden="true"></i> 공지사항을 관리할 수 있습니다.
            </div>
        </div>
        <!--// con_box -->

        <div class="con_box">

            <table class="tbl th_ver ta_left" border="0" cellpadding="0" cellspacing="0">
                <caption></caption>
                <colgroup>
                    <col width="15%" />
                    <col width="/" />
                </colgroup>
                <tbody>
                    <tr>
                        <th scope="row">제목</th>
                        <td><input type="text" name="title" value="@notice.title"/></td>
                    </tr>
                    <tr>
                        <th scope="row">등록일</th>
                        <td>
                            <span class="datepicker">
                                <input type="text" id="inputRegDate" name="inputRegDate" style="width:15%;" value="@notice.inputRegDate"/>
                            </span>
                        </td>
                    </tr>
                    <tr>
                        <th>첨부파일 1</th>

                        @if (notice.fileInfoList.Count == 0 || notice.fileInfoList.Where(x => x.fileInputName == "uploadFile1").Count() == 0)
                        {
                            <td class="filebox">
                                <input class="upload-name" id="fileName1" name="fileName[]" style="width:400px;" value="파일선택" disabled="disabled" />
                                <label for="uploadFile1">업로드</label>
                                <input type="file" id="uploadFile1" name="uploadFile1" class="upload-hidden">
                            </td>

                        }
                        else
                        {
                            <td class="filebox">
                                <input class="upload-name fileName1" style="width:400px;" value="@notice.fileInfoList.Where(x => x.fileInputName == "uploadFile1").First().fileOrgName" disabled="disabled">
                                <label for="uploadFile1">업로드</label>
                                <input type="file" id="uploadFile1" name="uploadFile1" class="upload-hidden">
                                <label class="uploadFile del1" for="ex_filename" onclick="onDeleteFile(document.editForm, 1); return false;">삭제</label>
                            </td>
                        }

                    </tr>
                    <tr>
                        <th>첨부파일 2</th>
                        @if (notice.fileInfoList.Count == 0 || notice.fileInfoList.Where(x => x.fileInputName == "uploadFile2").Count() == 0)
                        {

                            <td class="filebox">
                                <input class="upload-name" id="fileName2" name="fileName[]" style="width:400px;" value="파일선택" disabled="disabled" />
                                <label for="uploadFile2">업로드</label>
                                <input type="file" id="uploadFile2" name="uploadFile2" class="upload-hidden">
                            </td>
                        }
                        else
                        {

                            <td class="filebox">
                                <input class="upload-name fileName2" style="width:400px;" value="@notice.fileInfoList.Where(x => x.fileInputName == "uploadFile2").First().fileOrgName" disabled="disabled">
                                <label for="uploadFile2">업로드</label>
                                <input type="file" id="uploadFile2" name="uploadFile2" class="upload-hidden">
                                <label class="uploadFile del2" for="ex_filename" onclick="onDeleteFile(document.editForm, 2); return false;">삭제</label>
                            </td>
                        }


                    </tr>
                    <tr>
                        <th>첨부파일 3</th>

                        @if (notice.fileInfoList.Count == 0 || notice.fileInfoList.Where(x => x.fileInputName == "uploadFile3").Count() == 0)
                        {

                            <td class="filebox">
                                <input class="upload-name" id="fileName3" name="fileName[]" style="width:400px;" value="파일선택" disabled="disabled" />
                                <label for="uploadFile3">업로드</label>
                                <input type="file" id="uploadFile3" name="uploadFile3" class="upload-hidden">
                            </td>
                        }
                        else
                        {

                            <td class="filebox">
                                <input class="upload-name fileName3" style="width:400px;" value="@notice.fileInfoList.Where(x => x.fileInputName == "uploadFile3").First().fileOrgName" disabled="disabled">
                                <label for="uploadFile3">업로드</label>
                                <input type="file" id="uploadFile3" name="uploadFile3" class="upload-hidden">
                                <label class="uploadFile del3" for="ex_filename" onclick="onDeleteFile(document.editForm, 3); return false;">삭제</label>
                            </td>
                        }

                    </tr>
                    <tr>
                        <th>첨부파일 4</th>

                        @if (notice.fileInfoList.Count == 0 || notice.fileInfoList.Where(x => x.fileInputName == "uploadFile4").Count() == 0)
                        {
                            <td class="filebox">
                                <input class="upload-name" id="fileName4" name="fileName[]" style="width:400px;" value="파일선택" disabled="disabled" />
                                <label for="uploadFile4">업로드</label>
                                <input type="file" id="uploadFile4" name="uploadFile4" class="upload-hidden">
                            </td>
                        }
                        else
                        {

                            <td class="filebox">
                                <input class="upload-name fileName4" style="width:400px;" value="@notice.fileInfoList.Where(x => x.fileInputName == "uploadFile4").First().fileOrgName" disabled="disabled">
                                <label for="uploadFile4">업로드</label>
                                <input type="file" id="uploadFile4" name="uploadFile4" class="upload-hidden">
                                <label class="uploadFile del4" for="ex_filename" onclick="onDeleteFile(document.editForm, 4); return false;">삭제</label>
                            </td>
                        }
    
                    </tr>
                    <tr>
                        <th>첨부파일 5</th>

                        @if (notice.fileInfoList.Count == 0 || notice.fileInfoList.Where(x => x.fileInputName == "uploadFile5").Count() == 0)
                        {
                            <td class="filebox">
                                <input class="upload-name" id="fileName5" name="fileName[]" style="width:400px;" value="파일선택" disabled="disabled" />
                                <label for="uploadFile5">업로드</label>
                                <input type="file" id="uploadFile5" name="uploadFile5" class="upload-hidden">
                            </td>
                        }
                        else
                        {

                            <td class="filebox">
                                <input class="upload-name fileName5" style="width:400px;" value="@notice.fileInfoList.Where(x => x.fileInputName == "uploadFile5").First().fileOrgName" disabled="disabled">
                                <label for="uploadFile5">업로드</label>
                                <input type="file" id="uploadFile5" name="uploadFile5" class="upload-hidden">
                                <label class="uploadFile del5" for="ex_filename" onclick="onDeleteFile(document.editForm, 5); return false;">삭제</label>
                            </td>
                        }
    
                    </tr>
                    <tr>
                        <th>내용</th>
                        <td>
                            <div class="editerBox">
                                <textarea id="editor" rows="10" cols="100">@notice.contents</textarea>
                                <input type="hidden" id="contents" name="contents" />
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <th>사용여부</th>
                        <td>
                            <div class="style_radio">
                                <label>
                                    <input type="radio" name="isUse" value="Y" @(notice.isUse.Equals("Y") ? "checked":"")><i></i>
                                    <strong>사용</strong>
                                </label>
                            </div>
                            <div class="style_radio">
                                <label>
                                    <input type="radio" name="isUse" value="N" @(notice.isUse.Equals("N") ? "checked" : "")><i></i>
                                    <strong>미사용</strong>
                                </label>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>

            <div class="btn_area align_left_right">
                <a href="javascript:;" onclick="onSearch(document.editForm)" class="btn full_green left">목록</a>
                <a href="#" onclick="onEdit(document.editForm); return false;" class="btn full_green">저장</a>
                <a href="#" onclick="onDelete(document.editForm);" class="btn full_green">삭제</a>
            </div><!--//btn_area-->
        </div>
        <!--// con_box -->
    </form>

</div><!--//container-->


<script type="text/javascript" src="/Contents/SiteMngHome/Common/se/js/HuskyEZCreator.js" charset="utf-8"></script>
<script>
    var obj = [];
    setNhnSmartEditor(obj, "editor", "notice"); // 에디트 세팅

    $(function () {
        MYAPP.fileStyle.init();
        MYAPP.form.datePicker("#inputRegDate");
    });

    function onEdit(form) {
        // 에디트 정보 세팅
        obj.getById["editor"].exec("UPDATE_CONTENTS_FIELD", []);
        $("input[name=contents]").val($("#editor").val());


        if (form.title.value == "" || form.title.value == null) {
            alert("제목은 필수입니다.");
            return false;
        }
        if (form.inputRegDate.value == "" || form.inputRegDate.value == null) {
            alert("등록일은 필수입니다.");
            return false;
        }
        if ($("input[name=contents]").val() == "" || $("input[name=contents]").val() == null) {
            alert("내용은 필수입니다.");
            return false;
        }

        // 정보 체크 후, 해당 폼 SUBMIT;
        form.method = "POST";
        form.action = "editAction";
        form.submit();

    }

    function onSearch(form) {
        form.action = "/SiteMngHome/MngInfo/Notice_Mng/List";
        form.method = "POST";
        form.submit();
    }

    function onDeleteFile(form, type) {
        if (type == 0) { inputName = "uploadFile"; inputId = "fileName"; }
        else if (type == 1) { inputName = "uploadFile1"; inputId = "fileName1"; }
        else if (type == 2) { inputName = "uploadFile2"; inputId = "fileName2"; }
        else if (type == 3) { inputName = "uploadFile3"; inputId = "fileName3"; }
        else if (type == 4) { inputName = "uploadFile4"; inputId = "fileName4"; }
        else if (type == 5) { inputName = "uploadFile5"; inputId = "fileName5"; }
        $("#inputName").val(inputName);
        // ajax 분기 처리 할 것

        var param = $("#editForm").serialize();
        $.ajax({
            url: "/SiteMngHome/MngInfo/Notice_Mng/deleteFileAction",
            type: "post",
            dataType: "json",
            data: param,
            success: function (res) {
                if (res.success) {
                    alert("파일이 삭제되었습니다.");
                    $("." + inputName).css({ "display": "none" });
                    $("." + inputId).val("");
                    $(".del" + type).css({ "display": "none" });
                } else {
                    alert("파일 삭제가 실패되었습니다.");
                }
            },
            error: function (request, status, error) {
                alert("파일 삭제가 실패되었습니다.");
            }
        });
    }

    function onDelete(form) {
        if (confirm("삭제하시겠습니까?")) {
            form.method = "POST";
            form.action = "deleteAction";
            form.submit();
        }
    }

    // history back observed
    window.onload = function () {
        if (typeof history.pushState === "function") {
            history.pushState("halla", null, null);
            window.onpopstate = function () {
                location.href = "list";
            };
        }
    };
</script>

